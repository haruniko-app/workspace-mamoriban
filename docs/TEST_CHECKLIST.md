# Workspace守り番 テスト項目一覧

**作成日**: 2025年11月30日

---

## 概要

このドキュメントは、実装状況を確認するためのテスト項目一覧です。
自動テストで確認可能な項目と、手動確認が必要な項目に分類しています。

---

## 1. 自動テストで確認可能（Claude実行可能）

### 1.1 TypeScriptビルドチェック

| 項目 | コマンド | 確認内容 |
|------|---------|---------|
| バックエンドTypeScript | `cd backend && npx tsc --noEmit` | コンパイルエラーなし |
| フロントエンドTypeScript | `cd frontend && npx tsc --noEmit` | コンパイルエラーなし |
| フロントエンドビルド | `cd frontend && npm run build` | Viteビルド成功 |

### 1.2 ユニットテスト

| テストファイル | テスト数 | 確認内容 |
|--------------|---------|---------|
| `backend/src/services/risk.test.ts` | 30 | リスク計算ロジック |
| `backend/src/services/stripe.test.ts` | 19 | 料金プラン管理 |
| `backend/src/services/drive.test.ts` | 17 | Drive共有判定 |
| `backend/src/routes/api.test.ts` | 18 | API統合テスト |
| `frontend/e2e/pages.spec.ts` | 12 | E2Eテスト |

**実行コマンド**:
```bash
cd backend && npm run test
cd frontend && npm run test:e2e
```

### 1.3 APIエンドポイント確認（curl）

| エンドポイント | メソッド | 期待レスポンス |
|--------------|---------|--------------|
| `/health` | GET | `{"status":"ok"}` |
| `/api` | GET | `{"message":"Workspace守り番 API","version":"0.1.0"}` |
| `/api/stripe/plans` | GET | 4プラン（free/basic/pro/enterprise） |
| `/api/auth/me` | GET | 401 Unauthorized（未認証時） |
| `/api/scan/start` | POST | 401 Unauthorized（未認証時） |
| `/api/organization` | GET | 401 Unauthorized（未認証時） |
| `/api/delegation/status` | GET | 401 Unauthorized（未認証時） |

### 1.4 ファイル存在確認

| カテゴリ | ファイル | 確認内容 |
|---------|---------|---------|
| バックエンド | `backend/src/routes/delegation.ts` | Domain-Wide Delegation API |
| バックエンド | `backend/src/services/serviceAccount.ts` | サービスアカウント認証 |
| バックエンド | `backend/src/services/firestore.ts` | Firestoreサービス（IntegratedScanJobService含む） |
| フロントエンド | `frontend/src/pages/DelegationPage.tsx` | 統合スキャン設定ページ |
| フロントエンド | `frontend/src/pages/ReportsPage.tsx` | レポートページ |
| フロントエンド | `frontend/src/pages/AdminDashboardPage.tsx` | 管理者ダッシュボード |
| フロントエンド | `frontend/src/pages/NotificationsPage.tsx` | 通知設定ページ |

---

## 2. 手動確認が必要な項目

### 2.1 認証フロー

| # | テスト項目 | 確認手順 | 期待結果 |
|---|----------|---------|---------|
| A-1 | 初回ログイン | ログインページで「Googleでログイン」クリック | Google OAuth認証画面が表示される |
| A-2 | OAuth認証完了 | Google認証を完了 | ウェルカムページにリダイレクト |
| A-3 | 2回目ログイン | 再度ログイン操作 | 同意画面なしでダッシュボードへ |
| A-4 | ログアウト | ヘッダーのログアウトボタン | ログイン画面に戻る |
| A-5 | セッション切れ | 一定時間後にアクセス | ログイン画面にリダイレクト |
| A-6 | OAuthキャンセル | OAuth画面でキャンセル | 「ログインがキャンセルされました」表示 |

### 2.2 ダッシュボード

| # | テスト項目 | 確認手順 | 期待結果 |
|---|----------|---------|---------|
| D-1 | リスクサマリー表示 | ダッシュボードにアクセス | 4つのリスクカード（緊急/高/中/低）表示 |
| D-2 | スキャン履歴表示 | ダッシュボードにアクセス | スキャン履歴一覧が表示（日時正常） |
| D-3 | 履歴クリック | スキャン履歴アイテムをクリック | ファイル一覧ページに遷移 |
| D-4 | ページネーション | 5件以上の履歴がある場合 | 前へ/次へボタンが動作 |

### 2.3 スキャン機能

| # | テスト項目 | 確認手順 | 期待結果 |
|---|----------|---------|---------|
| S-1 | スキャン開始 | スキャンページで「スキャン開始」クリック | スキャンが開始される |
| S-2 | 進捗表示 | スキャン実行中 | 「X/Y件処理中」とプログレスバー表示 |
| S-3 | 完了表示 | スキャン完了後 | リスクサマリーが表示される |
| S-4 | 残りスキャン数 | スキャンページにアクセス | 「今月の残りスキャン: X/Y回」表示 |
| S-5 | URL状態保持 | ブラウザの戻るボタン | スキャン結果が維持される |
| S-6 | タイムアウト | 10分以上経過 | タイムアウト警告表示 |

### 2.4 ファイル一覧・詳細

| # | テスト項目 | 確認手順 | 期待結果 |
|---|----------|---------|---------|
| F-1 | ファイル一覧表示 | スキャン完了後「ファイル詳細を見る」 | ファイル一覧が表示される |
| F-2 | リスクフィルター | リスクレベル（Critical等）でフィルタ | 該当ファイルのみ表示 |
| F-3 | 所有者フィルター | 「すべて/自社/外部」切り替え | フィルターが動作する |
| F-4 | ファイル詳細モーダル | ファイル行をクリック | モーダルが開く |
| F-5 | リスク要因表示 | モーダル内 | リスク要因と改善提案が表示 |
| F-6 | 権限一覧表示 | モーダル内 | 共有設定（権限）一覧が表示 |
| F-7 | Google Driveリンク | 「共有設定を開く」クリック | Google Driveが新タブで開く |
| F-8 | フォルダビュー | 表示モード切替 | フォルダ別グルーピング表示 |

### 2.5 権限変更機能

| # | テスト項目 | 確認手順 | 期待結果 |
|---|----------|---------|---------|
| P-1 | 権限削除ボタン | ファイル詳細モーダルの権限行 | ゴミ箱アイコンが表示 |
| P-2 | 権限削除実行 | 削除ボタン→確認ダイアログ→実行 | 権限が削除される |
| P-3 | 閲覧者に変更 | 「閲覧者に変更」ボタンクリック | 権限が変更される |
| P-4 | 外部オーナー警告 | 外部オーナーファイルの権限 | 変更不可の警告表示 |
| P-5 | 一括操作モード | 「一括操作」ボタンクリック | チェックボックスが表示 |
| P-6 | 一括選択 | 複数ファイルを選択 | 「X件選択中」表示 |
| P-7 | 一括削除実行 | 「公開削除」ボタンクリック | 確認後、一括削除される |

### 2.6 Domain-Wide Delegation（統合スキャン）

| # | テスト項目 | 確認手順 | 期待結果 |
|---|----------|---------|---------|
| DW-1 | ページアクセス | `/delegation`にアクセス | 設定ページが表示される |
| DW-2 | 設定ガイド表示 | 未設定時 | 5ステップの設定手順が表示 |
| DW-3 | JSON入力 | サービスアカウントJSONを貼り付け | 入力欄が受け付ける |
| DW-4 | 設定保存 | 「サービスアカウントを設定」クリック | 設定が保存される |
| DW-5 | 検証実行 | 「検証」ボタンクリック | 検証結果が表示される |
| DW-6 | ユーザー一覧 | 検証成功後 | 組織内ユーザー一覧が表示 |
| DW-7 | 統合スキャン開始 | 「全ユーザーをスキャン」クリック | スキャンが開始される |
| DW-8 | 進捗表示 | スキャン実行中 | ユーザーごとの進捗が表示 |
| DW-9 | キャンセル | 「キャンセル」ボタンクリック | スキャンがキャンセルされる |
| DW-10 | 完了表示 | スキャン完了後 | 結果サマリーとリンクが表示 |
| DW-11 | 再起動後継続 | サーバー再起動 | runningジョブが自動再開 |

### 2.7 レポート機能

| # | テスト項目 | 確認手順 | 期待結果 |
|---|----------|---------|---------|
| R-1 | ページアクセス | `/reports`にアクセス | 5種類のレポートカードが表示 |
| R-2 | スキャン履歴レポート | カードをクリック | レポートが生成・表示される |
| R-3 | リスクアセスメントレポート | カードをクリック、スキャン選択 | レポートが生成・表示される |
| R-4 | PDFダウンロード | 「PDF」ボタンクリック | PDFファイルがダウンロード |
| R-5 | JSONダウンロード | 「JSON」ボタンクリック | JSONデータが表示/コピー可能 |

### 2.8 通知設定

| # | テスト項目 | 確認手順 | 期待結果 |
|---|----------|---------|---------|
| N-1 | ページアクセス | `/notifications`にアクセス | 通知設定ページが表示 |
| N-2 | メール通知ON/OFF | トグルスイッチ操作 | 設定が保存される |
| N-3 | 受信者追加 | メールアドレス入力→追加 | 受信者リストに追加 |
| N-4 | 受信者削除 | 削除ボタンクリック | 受信者リストから削除 |
| N-5 | テスト通知 | 「テスト通知を送信」クリック | テストメールが送信される |
| N-6 | 通知履歴 | 「履歴」タブをクリック | 通知履歴一覧が表示 |

### 2.9 管理者ダッシュボード

| # | テスト項目 | 確認手順 | 期待結果 |
|---|----------|---------|---------|
| AD-1 | ページアクセス（管理者） | 管理者でログイン→`/admin` | ダッシュボードが表示 |
| AD-2 | ページアクセス（メンバー） | メンバーでログイン→`/admin` | アクセス拒否表示 |
| AD-3 | 統計表示 | ダッシュボードにアクセス | 総ユーザー数、スキャン状況表示 |
| AD-4 | ユーザー別リスク | ユーザー一覧 | 各ユーザーのリスク状況表示 |
| AD-5 | ユーザー詳細展開 | ユーザー行をクリック | スキャン履歴が展開表示 |

### 2.10 設定・組織管理

| # | テスト項目 | 確認手順 | 期待結果 |
|---|----------|---------|---------|
| O-1 | 設定ページ | `/settings`にアクセス | アカウント/組織/プラン情報表示 |
| O-2 | プランアップグレード | 「アップグレード」ボタン | Stripeチェックアウト画面へ |
| O-3 | 組織管理ページ | `/organization`にアクセス | メンバー一覧が表示 |
| O-4 | 役割変更 | メンバーの役割を変更 | 役割が更新される |
| O-5 | メンバー削除 | メンバーを削除 | メンバーが削除される |

### 2.11 Stripe決済

| # | テスト項目 | 確認手順 | 期待結果 |
|---|----------|---------|---------|
| ST-1 | チェックアウト | プランをアップグレード | Stripe決済画面が表示 |
| ST-2 | 決済完了 | テストカードで決済 | プランが更新される |
| ST-3 | 顧客ポータル | 「お支払い管理」クリック | Stripeポータルが開く |
| ST-4 | Webhook受信 | 決済イベント発生 | Firestoreのプランが更新 |

---

## 3. テスト実行手順

### 3.1 自動テスト実行（Claude実行）

```bash
# TypeScriptチェック
cd /Users/abehiroshi/playground-claude-dev/projects/Workspace_守り番
cd backend && npx tsc --noEmit
cd ../frontend && npx tsc --noEmit

# ユニットテスト
cd ../backend && npm run test

# E2Eテスト
cd ../frontend && npm run test:e2e

# APIヘルスチェック（開発サーバー起動中）
curl http://localhost:8080/health
curl http://localhost:8080/api
curl http://localhost:8080/api/stripe/plans
```

### 3.2 手動テスト実行

1. 開発サーバーを起動
   ```bash
   npm run dev
   ```

2. ブラウザで http://localhost:5173 にアクセス

3. 上記の手動確認項目を順番に実施

---

## 4. テスト環境要件

| 項目 | 要件 |
|------|------|
| ブラウザ | Chrome最新版推奨 |
| Node.js | v18以上 |
| Google Workspace | テスト用アカウント |
| Stripe | テストモード有効 |
| GCP | Firestoreエミュレータまたは本番接続 |

---

## 5. 既知の問題・制限

| 項目 | 内容 | 対応状況 |
|------|------|---------|
| scan.ts TypeScriptエラー | `fileIds`と`permission_bulk_update`の型エラー | 未対応（既存問題） |
| PDFレポート | `puppeteer`未インストール時はエラー | 将来対応予定 |
| Slack通知 | 型定義のみ、実装未完了 | 将来対応予定 |

---

**最終更新**: 2025年11月30日
