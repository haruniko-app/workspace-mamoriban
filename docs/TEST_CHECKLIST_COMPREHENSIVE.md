# Workspace守り番 包括的テスト項目一覧

**作成日**: 2025年11月30日

---

## 概要

このドキュメントは、Workspace守り番の実装状況を網羅的に確認するためのテスト項目一覧です。

- **セクションA**: Claude（自動）が実行可能なテスト
- **セクションB**: ユーザーが手動で実行するテスト

---

# セクションA: Claude実行可能テスト

## A1. ビルド・型チェック

| # | テスト項目 | コマンド | 期待結果 |
|---|-----------|---------|---------|
| A1-1 | バックエンドTypeScript | `cd backend && npx tsc --noEmit` | エラーなし |
| A1-2 | フロントエンドTypeScript | `cd frontend && npx tsc --noEmit` | エラーなし |
| A1-3 | フロントエンドビルド | `cd frontend && npm run build` | ビルド成功 |

## A2. ユニットテスト

| # | テストファイル | テスト数 | 確認内容 |
|---|--------------|---------|---------|
| A2-1 | `backend/src/services/risk.test.ts` | 30 | リスク計算ロジック |
| A2-2 | `backend/src/services/stripe.test.ts` | 19 | 料金プラン管理 |
| A2-3 | `backend/src/services/drive.test.ts` | 17 | Drive共有判定 |
| A2-4 | `backend/src/routes/api.test.ts` | 18 | API統合テスト |

**実行コマンド**: `cd backend && npm run test`

## A3. APIエンドポイント存在確認（開発サーバー起動時）

### A3-1. 認証不要エンドポイント

| # | エンドポイント | メソッド | 期待レスポンス |
|---|--------------|---------|--------------|
| A3-1-1 | `/health` | GET | `{"status":"ok"}` |
| A3-1-2 | `/api` | GET | `{"message":"Workspace守り番 API","version":"0.1.0"}` |
| A3-1-3 | `/api/stripe/plans` | GET | 4プラン返却 |
| A3-1-4 | `/api/auth/login` | GET | Google OAuthリダイレクト（302） |

### A3-2. 認証必須エンドポイント（401確認）

| # | エンドポイント | メソッド | 期待レスポンス |
|---|--------------|---------|--------------|
| A3-2-1 | `/api/auth/me` | GET | 401 Unauthorized |
| A3-2-2 | `/api/scan/start` | POST | 401 Unauthorized |
| A3-2-3 | `/api/organization` | GET | 401 Unauthorized |
| A3-2-4 | `/api/delegation/status` | GET | 401 Unauthorized |
| A3-2-5 | `/api/reports/scan-history` | GET | 401 Unauthorized |
| A3-2-6 | `/api/notifications/settings` | GET | 401 Unauthorized |
| A3-2-7 | `/api/audit-logs/summary` | GET | 401 Unauthorized |

## A4. ファイル存在確認

### A4-1. バックエンド主要ファイル

| # | ファイルパス | 確認内容 |
|---|------------|---------|
| A4-1-1 | `backend/src/routes/auth.ts` | 認証API |
| A4-1-2 | `backend/src/routes/scan.ts` | スキャンAPI |
| A4-1-3 | `backend/src/routes/reports.ts` | レポートAPI |
| A4-1-4 | `backend/src/routes/organization.ts` | 組織API |
| A4-1-5 | `backend/src/routes/delegation.ts` | Domain-Wide Delegation API |
| A4-1-6 | `backend/src/routes/stripe.ts` | Stripe API |
| A4-1-7 | `backend/src/routes/notifications.ts` | 通知API |
| A4-1-8 | `backend/src/routes/auditLogs.ts` | 監査ログAPI |
| A4-1-9 | `backend/src/services/drive.ts` | Driveサービス |
| A4-1-10 | `backend/src/services/risk.ts` | リスク計算 |
| A4-1-11 | `backend/src/services/firestore.ts` | Firestoreサービス |
| A4-1-12 | `backend/src/services/stripe.ts` | Stripeサービス |
| A4-1-13 | `backend/src/services/reports.ts` | レポートサービス |
| A4-1-14 | `backend/src/services/serviceAccount.ts` | サービスアカウント |
| A4-1-15 | `backend/src/services/pdfGenerator.ts` | PDF生成 |

### A4-2. フロントエンド主要ファイル

| # | ファイルパス | 確認内容 |
|---|------------|---------|
| A4-2-1 | `frontend/src/pages/LoginPage.tsx` | ログインページ |
| A4-2-2 | `frontend/src/pages/WelcomePage.tsx` | ウェルカムページ |
| A4-2-3 | `frontend/src/pages/DashboardPage.tsx` | ダッシュボード |
| A4-2-4 | `frontend/src/pages/AdminDashboardPage.tsx` | 管理者ダッシュボード |
| A4-2-5 | `frontend/src/pages/ScanPage.tsx` | スキャンページ |
| A4-2-6 | `frontend/src/pages/FilesPage.tsx` | ファイル一覧 |
| A4-2-7 | `frontend/src/pages/ReportsPage.tsx` | レポートページ |
| A4-2-8 | `frontend/src/pages/SettingsPage.tsx` | 設定ページ |
| A4-2-9 | `frontend/src/pages/NotificationsPage.tsx` | 通知設定ページ |
| A4-2-10 | `frontend/src/pages/AuditLogsPage.tsx` | 監査ログページ |
| A4-2-11 | `frontend/src/pages/OrganizationPage.tsx` | 組織ページ |
| A4-2-12 | `frontend/src/pages/DelegationPage.tsx` | 統合スキャン設定ページ |
| A4-2-13 | `frontend/src/pages/PrivacyPage.tsx` | プライバシーポリシー |
| A4-2-14 | `frontend/src/pages/TermsPage.tsx` | 利用規約 |

## A5. リスク計算ロジック確認

| # | テスト項目 | 期待値 |
|---|-----------|--------|
| A5-1 | 公開リンク共有（自社オーナー） | +50点 |
| A5-2 | 外部ユーザー共有（自社オーナー） | +20点 |
| A5-3 | 外部編集権限（自社オーナー） | +25点 |
| A5-4 | 機密ファイル形式 | +15点 |
| A5-5 | 長期未更新の共有 | +10点 |
| A5-6 | 外部オーナー係数（編集者あり） | 30% |
| A5-7 | 外部オーナー係数（閲覧者のみ） | 10% |
| A5-8 | リスクレベル閾値（Critical） | 80-100点 |
| A5-9 | リスクレベル閾値（High） | 60-79点 |
| A5-10 | リスクレベル閾値（Medium） | 40-59点 |
| A5-11 | リスクレベル閾値（Low） | 0-39点 |

## A6. 型定義確認

| # | 型/インターフェース | ファイル | 確認内容 |
|---|-------------------|---------|---------|
| A6-1 | Organization | `types/models.ts` | 組織データ構造 |
| A6-2 | User | `types/models.ts` | ユーザーデータ構造 |
| A6-3 | Scan | `types/models.ts` | スキャンデータ構造 |
| A6-4 | ScannedFile | `types/models.ts` | スキャン済みファイル |
| A6-5 | ActionLog | `types/models.ts` | アクションログ |
| A6-6 | NotificationSettings | `types/models.ts` | 通知設定 |
| A6-7 | IntegratedScanJob | `types/models.ts` | 統合スキャンジョブ |

---

# セクションB: 手動テスト項目

## B1. 認証フロー

| # | テスト項目 | 確認手順 | 期待結果 |
|---|----------|---------|---------|
| B1-1 | 初回ログイン | ログインページで「Googleでログイン」クリック | Google OAuth認証画面が表示される |
| B1-2 | OAuth認証完了 | Google認証を完了 | ウェルカムページにリダイレクト |
| B1-3 | 2回目ログイン | 再度ログイン操作 | 同意画面なしでダッシュボードへ |
| B1-4 | ログアウト | ヘッダーのログアウトボタン | ログイン画面に戻る |
| B1-5 | セッション切れ | 一定時間後にアクセス | ログイン画面にリダイレクト |
| B1-6 | OAuthキャンセル | OAuth画面でキャンセル | エラーメッセージ表示 |
| B1-7 | 未認証アクセス | 直接`/dashboard`にアクセス | ログインページにリダイレクト |

## B2. ダッシュボード

| # | テスト項目 | 確認手順 | 期待結果 |
|---|----------|---------|---------|
| B2-1 | リスクサマリー表示 | ダッシュボードにアクセス | 4つのリスクカード（緊急/高/中/低）表示 |
| B2-2 | スキャン履歴表示 | ダッシュボードにアクセス | スキャン履歴一覧が表示 |
| B2-3 | 履歴クリック | スキャン履歴アイテムをクリック | ファイル一覧ページに遷移 |
| B2-4 | ページネーション | 5件以上の履歴がある場合 | 前へ/次へボタンが動作 |
| B2-5 | スキャンステータス | 各スキャンのステータス確認 | completed/running/failedが正しく表示 |

## B3. スキャン機能

| # | テスト項目 | 確認手順 | 期待結果 |
|---|----------|---------|---------|
| B3-1 | スキャン開始 | スキャンページで「スキャン開始」クリック | スキャンが開始される |
| B3-2 | カウントフェーズ | スキャン開始直後 | 「ファイル数を取得中...」表示 |
| B3-3 | スキャンフェーズ | カウント完了後 | 「X/Y件処理中」とプログレスバー表示 |
| B3-4 | 完了表示 | スキャン完了後 | リスクサマリーが表示される |
| B3-5 | 残りスキャン数 | スキャンページにアクセス | 「今月の残りスキャン: X/Y回」表示 |
| B3-6 | プラン制限 | 無料プランで2回目のスキャン | 制限メッセージ表示 |
| B3-7 | エラー発生時 | API権限エラー発生 | エラーメッセージが表示される |

## B4. ファイル一覧・詳細

| # | テスト項目 | 確認手順 | 期待結果 |
|---|----------|---------|---------|
| B4-1 | ファイル一覧表示 | スキャン完了後「ファイル詳細を見る」 | ファイル一覧が表示される |
| B4-2 | リスクフィルター | リスクレベル（Critical等）でフィルタ | 該当ファイルのみ表示 |
| B4-3 | 所有者フィルター | 「すべて/自社/外部」切り替え | フィルターが動作する |
| B4-4 | 検索機能 | ファイル名で検索 | 該当ファイルのみ表示 |
| B4-5 | ソート機能 | リスクスコア/名前/更新日でソート | ソートが動作する |
| B4-6 | ページネーション | 20件以上のファイルがある場合 | ページ切り替えが動作 |
| B4-7 | ファイル詳細モーダル | ファイル行をクリック | モーダルが開く |
| B4-8 | リスク要因表示 | モーダル内 | リスク要因と改善提案が表示 |
| B4-9 | 権限一覧表示 | モーダル内 | 共有設定（権限）一覧が表示 |
| B4-10 | Google Driveリンク | 「Driveで開く」クリック | Google Driveが新タブで開く |
| B4-11 | フォルダビュー | 表示モード切替 | フォルダ別グルーピング表示 |
| B4-12 | フォルダパス表示 | フォルダビューで確認 | フォルダ階層が正しく表示 |

## B5. 権限変更機能（単一ファイル）

| # | テスト項目 | 確認手順 | 期待結果 |
|---|----------|---------|---------|
| B5-1 | 権限削除ボタン | ファイル詳細モーダルの権限行 | ゴミ箱アイコンが表示 |
| B5-2 | 権限削除確認 | 削除ボタン→確認ダイアログ | 確認ダイアログが表示 |
| B5-3 | 権限削除実行 | 確認ダイアログで実行 | 権限が削除される |
| B5-4 | 閲覧者に変更 | 「閲覧者に変更」ボタンクリック | 権限が変更される |
| B5-5 | 外部オーナー警告 | 外部オーナーファイルの権限 | 変更不可の警告表示 |
| B5-6 | 自分の権限削除 | 自分の権限を削除しようとする | 警告または禁止 |

## B6. 一括操作機能

| # | テスト項目 | 確認手順 | 期待結果 |
|---|----------|---------|---------|
| B6-1 | 一括操作モード | 「一括操作」ボタンクリック | チェックボックスが表示 |
| B6-2 | 一括選択 | 複数ファイルを選択 | 「X件選択中」表示 |
| B6-3 | 全選択 | 「すべて選択」クリック | 全ファイルが選択される |
| B6-4 | 公開アクセス削除 | 「公開削除」ボタンクリック | 確認後、一括削除される |
| B6-5 | 編集者を閲覧者に | 「閲覧者に変更」ボタンクリック | 確認後、一括変更される |
| B6-6 | 100件制限 | 100件以上選択しようとする | 制限メッセージ表示 |
| B6-7 | 結果表示 | 一括操作完了後 | 成功/失敗件数が表示 |

## B7. フォルダ権限操作

| # | テスト項目 | 確認手順 | 期待結果 |
|---|----------|---------|---------|
| B7-1 | フォルダ権限表示 | フォルダビューでフォルダ選択 | フォルダの権限一覧が表示 |
| B7-2 | フォルダ権限削除 | フォルダ権限の削除ボタン | フォルダ配下に権限変更が反映 |
| B7-3 | フォルダ権限変更 | フォルダ権限の役割変更 | フォルダ配下に権限変更が反映 |

## B8. Domain-Wide Delegation（統合スキャン）

| # | テスト項目 | 確認手順 | 期待結果 |
|---|----------|---------|---------|
| B8-1 | ページアクセス | `/delegation`にアクセス | 設定ページが表示される |
| B8-2 | 設定ガイド表示 | 未設定時 | 設定手順ガイドが表示 |
| B8-3 | JSON入力 | サービスアカウントJSONを貼り付け | 入力欄が受け付ける |
| B8-4 | 設定保存 | 「サービスアカウントを設定」クリック | 設定が保存される |
| B8-5 | 検証実行 | 「検証」ボタンクリック | 検証結果が表示される |
| B8-6 | 検証失敗 | 無効な設定で検証 | エラーメッセージが表示 |
| B8-7 | ユーザー一覧 | 検証成功後 | 組織内ユーザー一覧が表示 |
| B8-8 | 統合スキャン開始 | 「全ユーザーをスキャン」クリック | スキャンが開始される |
| B8-9 | 進捗表示 | スキャン実行中 | ユーザーごとの進捗が表示 |
| B8-10 | キャンセル | 「キャンセル」ボタンクリック | スキャンがキャンセルされる |
| B8-11 | 完了表示 | スキャン完了後 | 結果サマリーとリンクが表示 |
| B8-12 | 設定削除 | 「設定を削除」クリック | 設定が削除される（オーナーのみ） |

## B9. レポート機能

| # | テスト項目 | 確認手順 | 期待結果 |
|---|----------|---------|---------|
| B9-1 | ページアクセス | `/reports`にアクセス | 5種類のレポートカードが表示 |
| B9-2 | スキャン履歴レポート | カードをクリック | レポートが生成・表示される |
| B9-3 | リスクアセスメントレポート | カードをクリック、スキャン選択 | レポートが生成・表示される |
| B9-4 | 是正措置履歴レポート | カードをクリック | 権限変更履歴が表示される |
| B9-5 | 外部共有一覧レポート | カードをクリック、スキャン選択 | 外部共有ファイルが表示される |
| B9-6 | 現在のリスクレポート | カードをクリック | 現在のリスク状況が表示される |
| B9-7 | PDFダウンロード | 「PDF」ボタンクリック | PDFファイルがダウンロード |
| B9-8 | JSONプレビュー | 「JSON」ボタンクリック | JSONデータが表示/コピー可能 |
| B9-9 | 日付フィルター | 日付範囲を指定 | フィルターが動作する |

## B10. 通知設定

| # | テスト項目 | 確認手順 | 期待結果 |
|---|----------|---------|---------|
| B10-1 | ページアクセス | `/notifications`にアクセス | 通知設定ページが表示 |
| B10-2 | メール通知ON/OFF | トグルスイッチ操作 | 設定が保存される |
| B10-3 | 受信者追加 | メールアドレス入力→追加 | 受信者リストに追加 |
| B10-4 | 受信者削除 | 削除ボタンクリック | 受信者リストから削除 |
| B10-5 | 無効なメール | 無効な形式のメールを入力 | バリデーションエラー |
| B10-6 | テスト通知 | 「テスト通知を送信」クリック | テストメールが送信される |
| B10-7 | 通知履歴 | 「履歴」タブをクリック | 通知履歴一覧が表示 |

## B11. 監査ログ

| # | テスト項目 | 確認手順 | 期待結果 |
|---|----------|---------|---------|
| B11-1 | ページアクセス | `/audit-logs`にアクセス | 監査ログページが表示 |
| B11-2 | ログタイプ切替 | Drive/Login/Admin/共有変更/外部共有 | 各タイプのログが表示 |
| B11-3 | 日付フィルター | 日付範囲を指定 | フィルターが動作する |
| B11-4 | アクションログ | アプリ内アクション（権限変更）履歴 | 操作履歴が表示される |
| B11-5 | ページネーション | 20件以上のログがある場合 | ページ切り替えが動作 |
| B11-6 | サマリー表示 | サマリータブをクリック | 集計データが表示される |

## B12. 管理者ダッシュボード

| # | テスト項目 | 確認手順 | 期待結果 |
|---|----------|---------|---------|
| B12-1 | ページアクセス（管理者） | 管理者でログイン→`/admin-dashboard` | ダッシュボードが表示 |
| B12-2 | ページアクセス（メンバー） | メンバーでログイン→`/admin-dashboard` | アクセス拒否または非表示 |
| B12-3 | 統計表示 | ダッシュボードにアクセス | 総ユーザー数、スキャン状況表示 |
| B12-4 | ユーザー別リスク | ユーザー一覧 | 各ユーザーのリスク状況表示 |
| B12-5 | ユーザー詳細展開 | ユーザー行をクリック | スキャン履歴が展開表示 |

## B13. 設定・組織管理

| # | テスト項目 | 確認手順 | 期待結果 |
|---|----------|---------|---------|
| B13-1 | 設定ページ | `/settings`にアクセス | アカウント/組織/プラン情報表示 |
| B13-2 | 組織名変更 | 組織名を編集→保存 | 組織名が更新される |
| B13-3 | メンバー一覧 | 組織メンバータブ | メンバー一覧が表示 |
| B13-4 | 役割変更 | メンバーの役割を変更 | 役割が更新される |
| B13-5 | 自分の役割変更 | 自分自身の役割を変更 | 禁止または警告 |
| B13-6 | メンバー削除 | メンバーを削除 | メンバーが削除される |
| B13-7 | Workspaceユーザー同期 | Workspaceユーザー一覧表示 | Google Workspaceのユーザーが表示 |

## B14. Stripe決済

| # | テスト項目 | 確認手順 | 期待結果 |
|---|----------|---------|---------|
| B14-1 | プラン表示 | 設定ページのプランセクション | 現在のプランと他プランが表示 |
| B14-2 | アップグレード | 「アップグレード」ボタン | Stripeチェックアウト画面へ |
| B14-3 | 決済完了 | テストカード（4242...）で決済 | プランが更新される |
| B14-4 | 顧客ポータル | 「お支払い管理」クリック | Stripeポータルが開く |
| B14-5 | Webhook確認 | 決済イベント発生 | Firestoreのプランが更新 |
| B14-6 | ダウングレード | 下位プランに変更 | 次回請求日から変更 |

## B15. UIレスポンシブ対応

| # | テスト項目 | 確認手順 | 期待結果 |
|---|----------|---------|---------|
| B15-1 | デスクトップ表示 | 1920x1080で確認 | レイアウトが正常 |
| B15-2 | タブレット表示 | 768x1024で確認 | レイアウトが正常 |
| B15-3 | モバイル表示 | 375x667で確認 | レイアウトが正常 |
| B15-4 | サイドバー折りたたみ | モバイルでサイドバー | ハンバーガーメニュー動作 |

## B16. エラーハンドリング

| # | テスト項目 | 確認手順 | 期待結果 |
|---|----------|---------|---------|
| B16-1 | 404ページ | 存在しないURLにアクセス | 404エラーページ表示 |
| B16-2 | API エラー | バックエンド停止中にアクセス | エラーメッセージ表示 |
| B16-3 | トークン期限切れ | 長時間放置後に操作 | 再認証または自動リフレッシュ |
| B16-4 | ネットワークエラー | オフライン状態で操作 | エラーメッセージ表示 |

---

# 実行手順

## 1. Claude実行テスト

```bash
# プロジェクトルートで実行
cd /Users/abehiroshi/playground-claude-dev/projects/Workspace_守り番

# A1: ビルドチェック
cd backend && npx tsc --noEmit
cd ../frontend && npx tsc --noEmit && npm run build

# A2: ユニットテスト
cd ../backend && npm run test

# A3: APIテスト（開発サーバー起動後）
curl http://localhost:8080/health
curl http://localhost:8080/api
curl http://localhost:8080/api/stripe/plans
```

## 2. 手動テスト

1. 開発サーバーを起動
   ```bash
   npm run dev
   ```

2. ブラウザで http://localhost:5173 にアクセス

3. 上記B1〜B16のテスト項目を順番に実施

---

# テスト環境要件

| 項目 | 要件 |
|------|------|
| ブラウザ | Chrome最新版推奨 |
| Node.js | v18以上 |
| Google Workspace | テスト用アカウント（管理者権限推奨） |
| Stripe | テストモード有効 |
| GCP | Firestoreエミュレータまたは本番接続 |

---

# 既知の問題・制限

| 項目 | 内容 | 対応状況 |
|------|------|---------|
| PDFレポート | `puppeteer`未インストール時はエラー | PDFKit使用に変更済み |
| Slack通知 | 型定義のみ、実装未完了 | 将来対応予定 |
| E2Eテスト | Playwright設定済みだが未完成 | 将来対応予定 |

---

**最終更新**: 2025年11月30日
